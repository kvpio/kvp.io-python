
worker_processes {{ nginx.workers }};
user {{ nginx.user }} {{ nginx.group }};
...
events {
  use epoll;
  worker_connections 1024;
  {% if nginx.workers > 1 %}
  accept_mutex on;
  {% else %}
  accept_mutex off;
  {% endif %}
}
http {
  ...
  upstream app_server {
    server {{ my_app.ip }}:{{ my_app.port }} fail_timeout=0;
  }
  server {
    ...
    server_name {{ my_app.hostname }} www.{{ my_app.hostname }};
    root {{ nginx.default_public }};
    location @proxy_to_app {
      ...
      proxy_pass http://app_server;
    }
    error_page 500 502 503 504 /500.html;
    location = /500.html {
      root {{ nginx.default_public }};
    }
  }
}
